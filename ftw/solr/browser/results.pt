<div id="search-results-wrapper"
     tal:define="b_start python:0;
                 b_start request/b_start | b_start;
                 b_size python:10;
                 batch python: view.results(b_size=b_size, b_start=b_start);
                 snippets view/snippets;
                 suggestions view/suggestions|nothing;
                 normalizeString nocall:context/@@plone/normalizeString;">


  <metal:searchresults define-macro="search_results">
    <div id="search-results" i18n:domain="ftw.solr" tal:define="st python:request.get('SearchableText', '')">

        <div id="filter-form" i18n:domain="ftw.solr">
          <div>
            <div class="searchBox LSBox"
                 tal:define="portal context/@@plone_portal_state/portal;
                             first_call not:request/advanced_search|nothing;
                             DateTime python:modules['DateTime'].DateTime;">

              <input class="searchPage"
                     name="SearchableText"
                     type="text"
                     size="25"
                     title="Search Site"
                     placeholder="Search Site"
                     i18n:attributes="title title_search_site;
                                      placeholder title_search_site"
                     tal:attributes="value st;"
                     />
              <input class="searchPage searchButton allowMultiSubmit"
                     type="submit"
                     value="Search"
                     i18n:attributes="value label_search;"/>

              <div tal:define="fview nocall: context/@@search-facets | nothing"
                   tal:condition="python: fview"
                   tal:replace="structure fview/hiddenfields" />
            </div>
            <div class="search-facets">
              <div tal:define="facets nocall: context/@@available-facets | nothing"
                   tal:condition="python: batch and facets"
                   tal:replace="structure python: facets(results=view.solr_response)" />
            </div>
          </div>

        </div>

        <div class="searchinformation-wrapper">
          <div id="portal-searchfacets" class="searchinformations" i18n:domain="plone">
            <span i18n:translate="batch_x_items_matching_your_criteria">
              <span i18n:name="number"
                    class="amount"
                    tal:content="batch/sequence_length|string:0">
                234
              </span>
                items matching your search terms
            </span>

            <metal:suggestions tal:condition="suggestions" i18n:domain="ftw.solr">
                <p i18n:translate="text_did_you_mean">Did you mean&hellip;
                    <span i18n:name="suggestion">
                        <tal:block tal:repeat="suggestion suggestions">
                            <a tal:define="querystring python:suggestion[1]"
                               tal:content="python:suggestion[0]"
                               tal:attributes="href string:${request/ACTUAL_URL}?${querystring}"></a>
                        </tal:block>
                    </span>
                </p>
            </metal:suggestions>

            <div class="selected-factes-wrapper">
              <div tal:define="facets nocall: context/@@selected-facets | nothing"
                   tal:condition="python: facets"
                   tal:replace="structure python: facets(results=view.solr_response)" />
            </div>
          </div>
        </div>

        <metal:noresults tal:condition="not: batch">
          <p i18n:domain="plone"><strong i18n:translate="description_no_results_found">No results were found.</strong></p>
        </metal:noresults>

        <metal:results tal:condition="batch"
                       tal:define="isAnon context/@@plone_portal_state/anonymous;
                                   toLocalizedTime nocall: context/@@plone/toLocalizedTime;
                                   site_properties context/portal_properties/site_properties;
                                   allowAnonymousViewAbout site_properties/allowAnonymousViewAbout;
                                   show_about python:not isAnon or allowAnonymousViewAbout;">
          <dl class="searchResults">
            <tal:results repeat="item batch">
              <dt tal:attributes="class item/ContentTypeClass">
                <img tal:replace="structure item/getIcon|nothing" />
                <a href="#"
                   tal:define="result_url item/result_url | item/getURL"
                   tal:attributes="href result_url;
                                   class string:state-${item/review_state}"
                   tal:content="python: item.Title() or item.getId()" />
              </dt>
              <dd>
                <span class="discreet" i18n:domain="plone"
                      tal:condition="show_about">
                  <span class="documentAuthor"
                        i18n:translate="label_by_author">
                    by
                    <tal:block tal:condition="item/Creator"
                               tal:define="author python:context.portal_membership.getMemberInfo(item.Creator())">
                      <a href="#"
                         tal:attributes="href string:${context/@@plone_portal_state/navigation_root_url}/author/${item/Creator}"
                         tal:content="python:author and author['fullname'] or item.Creator()"
                         tal:omit-tag="not:item/Creator"
                         i18n:name="author">
                        Bob Dobalina
                      </a>
                    </tal:block>
                  </span>

                  <span tal:define="modification_date item/ModificationDate">

                    <span class="documentModified">
                      &mdash;
                      <span i18n:translate="box_last_modified">
                        last modified
                      </span>
                      <span tal:replace="python:toLocalizedTime(modification_date, long_format=1)">
                        August 16, 2001 at 23:35:59
                      </span>
                    </span>

                  </span>

                </span>

                <tal:snippet tal:define="hasSnippet python:item.UID in snippets">
                  <div tal:condition="hasSnippet"
                       tal:content="structure python:snippets[item.UID]">
                  </div>
                  <div tal:condition="not: hasSnippet"
                       tal:content="python:item.Description()">
                  </div>
                </tal:snippet>

                <tal:breadcrumbs define="breadcrumbs python: view.breadcrumbs(item)"
                                 condition="breadcrumbs">
                <cite class="documentLocation link-location"
                      tal:define="is_rtl context/@@plone_portal_state/is_rtl;"
                      tal:condition="breadcrumbs">
                  <span tal:repeat="crumb breadcrumbs"
                        tal:attributes="dir python:is_rtl and 'rtl' or 'ltr';">
                    <tal:item tal:define="is_last repeat/crumb/end;
                                          url crumb/absolute_url;
                                          title crumb/Title">
                      <a href="#"
                         tal:omit-tag="not: url"
                         tal:attributes="href url"
                         tal:content="title">
                        crumb
                      </a>
                      <span class="breadcrumbSeparator" tal:condition="not: is_last">
                        <tal:ltr condition="not: is_rtl">&rsaquo;</tal:ltr>
                        <tal:rtl condition="is_rtl">&lsaquo;</tal:rtl>
                      </span>
                    </tal:item>
                  </span>

                </cite>
                <cite class="documentLocation link-location" tal:condition="not:breadcrumbs">
                    <a href="#"
                       tal:attributes="href python:item.getRemoteUrl"
                       tal:content="python:item.getRemoteUrl"></a>
                </cite>
                </tal:breadcrumbs>

              </dd>
            </tal:results>
          </dl>
          <div metal:use-macro="context/batch_macros/macros/navigation" />
        </metal:results>
      </div>
    </metal:searchresults>

  </div>
